{% extends "base.html" %}
{% load i18n %}
{% load static %}


{% block extra_style %}

    <style>
      .team-img {
        flex: 0 0 auto;
        width: 2.25rem;
        height: 2.25rem;
        margin-right: 0.5rem;
        border-radius: 50%;
        background-color: #ddd;
        overflow: hidden;
      }

      .team-img img {
        width: 100%;
        height: 100%;
        object-fit: cover;
      }

      .team-details {
        flex: 0 0 auto;
        width: calc(100% - 2.75rem)
      }

      /* Add any additional CSS styles here if needed */
      .turnament-img {
        margin-right: 1rem;
        flex: 0 0 auto;
        width: 8rem;
        height: 8rem;
        border-radius: 50%;
        background-color: #ddd;
        overflow: hidden;
      }
      .turnament-img img {
        width: 100%;
        height: 100%;
        object-fit: cover;
      }
      
      .turnament-info {
        flex: 0 0 auto;
        width: calc(100% - 9rem);
      }

      .match-title {
        color: #666;
        font-weight: 600;
      }
      .vs-round {
        display: inline-block;
        margin-left: 0.875rem;
        margin-right: 0.875rem;
        width: 1.5rem;
        height: 1.5rem;
        font-size: 0.75rem;
        font-weight: 500;
        color: #fff;
        display: flex;
        justify-content: center;
        align-items: center;
        border-radius: 50%;
        /*border: 1px solid #e7e7e7;
        background-color: #fff;
        box-shadow: 0 2px 3px rgba(0,0,0,0.2);*/
        position: relative;
      }

      .vs-round:before,
      .vs-round:after {
        content: "";
        width:0.5rem;
        height: 2px;
        background-color: #e7e7e7;
        position: absolute;
        top: 50%;
      }

      .vs-round:before {
        right: 100%;
      }
      .vs-round:after {
        left: 100%;
      }

      table.table thead tr th,
      table.table tbody tr td {
        font-size: 0.875rem;
      }

      .table-striped>tbody>tr:nth-of-type(odd)>* {
        background-color: #fff;
      }

      .match-rasult [class*="col-"] {
        padding: 0.5rem 0.625rem;
        font-size: 0.875rem;
      }

      .match-rasult:nth-of-type(odd) {
        border-radius: 0.25rem;
        background-color: #f1f1f1;
      }

      .match-rasult [class*="col-"]:last-of-type {
        border-top-right-radius: 0.25rem;
        border-bottom-right-radius: 0.25rem;
      }

      .match-rasult [class*="col-"] .badge {
        padding: 0.375rem 0.5rem;
      }

      hr {
        margin-top: 0.5rem;
        margin-bottom: 0.5rem;
        opacity: 0.1;
      }


  </style>
{% endblock extra_style %}

{% block page_title %}
    Tournament
{% endblock %}

{% block content %}
    <div class="page-breadcrumb">
        <div class="row">
            <div class="col-12 d-flex no-block align-items-center">
                <h4 class="page-title">Tournament Details for {{tournament_details.name}} {{type}}</h4>
                <div class="ml-auto text-right">
                    <nav aria-label="breadcrumb">
                      {% if dis_message %}
                      <div id="alertMessage" class="alert alert-warning alert-dismissible fade show" role="alert">
                          <strong>{{dis_message}}</strong>  
                          <button type="button" class="close" data-dismiss="alert" aria-label="Close">
                              <span aria-hidden="true">&times;</span>
                          </button>                         
                        </div> 
                        <script>                            
                          setTimeout(function() {
                              document.getElementById('alertMessage').style.display = 'none';
                          }, 5000);
                      </script>                          
                        {% endif %}
                    </nav>
                </div>
            </div>
        </div>
    </div>

    <!-- Tournament Details -->
<!-- Tournament Details -->
<div class="container-fluid m-5">
  <div class="container">
    <div class="row mb-4">
      <div class="col-8">
        <!-- Leave this empty for spacing -->
      </div>
      <div class="col-4 d-flex justify-content-end">
        <a href="/admin/edit_tournamnet/{{ tournament_details.id }}/" class="btn btn-warning me-2" style="margin-right: 10px;">Edit</a>
        <button class="btn btn-danger ms-2" data-toggle="modal" data-target="#exampleModal">Delete</button>
      </div>
    </div>
    <div class="p-3 d-flex rounded-2 bg-white">
      <div class="turnament-img">
        <img src="https://blog.tennisplaza.com/wp-content/uploads/2020/06/0000s_0001_Tennis-Racket-and-Balls.jpg" alt="">
      </div>
      <div class="turnament-info">
        <div class="row gy-2">
          <div class="col-12">
            <h2 class="h5">{{tournament_details.name}}</h2>
          </div>
          {% if tournament_details.registration_start_date %}
          <div class="col-6">
            <small>Registration start Date: <strong>{{tournament_details.registration_start_date}}</strong></small>
          </div>
          {% endif %}
          {% if tournament_details.registration_end_date%}
          <div class="col-6">
            <small>Registration end Date: <strong>{{tournament_details.registration_end_date}}</strong></small>
          </div>
          {% endif %}
          <div class="col-6">
            <small>Start Date: <strong>{{tournament_details.leagues_start_date}}</strong></small>
          </div>
          {% if tournament_details.leagues_end_date%}
          <div class="col-6">
            <small>End Date: <strong>{{tournament_details.leagues_end_date}}</strong></small>
          </div>
          {% endif %}
          <div class="col-6">
            <small>Registartion Fees: <strong>{{tournament_details.registration_fee}}</strong></small>
          </div>
          {% if tournament_details.others_fees %}
          <div class="col-6">
            <small>Other Fees: <strong>{{tournament_details.others_fees}}</strong></small>
          </div>
          {% endif %}
          <div class="col-6">
            <small>Location: <strong>{{tournament_details.location}}</strong></small>
          </div>
          <div class="col-12 mt-3">
            <!-- {% comment %} {% for fee in  %}
            <p>{{fee.name}}: {{tournament_details.registration_fee}}</p>
            {% endfor %} {% endcomment %}
            Start Tournament Button -->
            <form method="POST">
              {% csrf_token %} 
              <button type="submit" class="btn btn-primary btn-sm" data-bs-toggle="modal" data-bs-target="#startTournamentModal" data-bs-toggle="tooltip" data-bs-placement="top">
                <strong>Start Tournament</strong>
              </button>
            </form>
          </div>
        </div>
      </div>
    </div>
  </div>
  {% if teams %}
  <div class="container mt-4">
    <div class="card">
      <div class="card-header" id="headingTwo">
        <h5 class="mb-0">
          <button class="btn bg-transparent border-0 text-black collapsed link-dark link-decoration-none" data-toggle="collapse" data-target="#collapseTwo" aria-expanded="false" aria-controls="collapseTwo">
            Teams
          </button>
        </h5>
      </div>
      <div id="collapseTwo" class="collapse" aria-labelledby="headingTwo" data-parent="#accordion">
        <div class="card-body">
          <div class="row">
            {% for team in teams %}
              <div class="col-2 mt-5">
                <div class="d-flex align-items-center gap-row-3">
                  <div class="team-img">
                    <img src="{{ team.team_image }}" class="img-fluid">
                  </div>
                  <div class="team-details mt-2">
                    {{ team.name }}
                  </div>
                </div>
              </div>
            {% endfor %}
          </div>
        </div>
      </div>
    </div>
  </div>
  {% endif %}
    <!-- Navigation Tabs -->
    {% if match|length != 0%}
    
    <div class="container mt-3">
      <ul class="nav nav-tabs" id="myTabs" role="tablist">
        <li class="nav-item" role="presentation">
          <button class="nav-link active" id="matches-tab" data-bs-toggle="tab" data-bs-target="#matches" type="button" role="tab" aria-controls="matches" aria-selected="true">Matches</button>
        </li>
        <li class="nav-item" role="presentation">
          <button class="nav-link" id="point-table-tab" data-bs-toggle="tab" data-bs-target="#point-table" type="button" role="tab" aria-controls="point-table" aria-selected="false">Point Table</button>
        </li>
        {% comment %} <li class="nav-item" role="presentation">
          <button class="nav-link" id="knockout-tab" data-bs-toggle="tab" data-bs-target="#knockout" type="button" role="tab" aria-controls="knockout" aria-selected="false">Knockout</button>
        </li> {% endcomment %}
      </ul>
    </div>
    {% endif %}
    
    <!-- Tab Content -->
    <div class="container mt-3" >
      <div class="tab-content" id="myTabContent">
        <!-- Matches -->
        <div class="tab-pane fade show active" id="matches" role="tabpanel" aria-labelledby="matches-tab">
          {% for mat in match %}
          <!-- Matches -->
          <div class="mb-3 bg-white rounded-1">
              <div class="py-2 px-3">
                <div class="d-flex align-items-center">
                  <div class="d-flex align-items-center">
                    <strong class="match-title mr-3">Match {{ mat.match_number }}:</strong> <span class="badge badge-secondary">{{ mat.team1__name }}</span> <span class="vs-round bg-warning">vs</span> <span class="badge badge-secondary">{{ mat.team2__name }}</span>
                  </div>
                  <button class="ml-auto btn btn-success btn-sm" type="button" data-bs-toggle="collapse" data-bs-target="#collapseExample{{ forloop.counter }}" aria-expanded="false" aria-controls="collapseExample">
                    
                      Match Score
                  </button>
                </div>
              </div>

              <div class="collapse mb-5" id="collapseExample{{ forloop.counter }}">
                <div class="py-2 px-3 border-top">
                    {% if mat.is_completed != True %}
                        <!-- Form for match score -->
                        <form action="/admin/submit_score/{{tournament_details.id}}/" method="post">
                          {% csrf_token %}
                            <input type="hidden" name="match_id" value="{{ mat.id }}">
                            {% for sc in mat.score %}
                            <div class="row g-0 match-rasult align-items-center">
                                <div class="col-4">
                                    <label for="team1_score" class="mb-0">{{ sc.name }}</label>
                                </div>
                                {% for set in sc.score %}
                                    <div class="col-2">
                                        <input type="number" class="form-control form-control-sm" id="team{{ forloop.parentloop.counter }}_score" name="team{{ forloop.parentloop.counter }}_score" value="{{ set }}" placeholder="Set {{forloop.counter}} score">
                                    </div>
                                {% endfor %}
                                <div class="col-2"></div>
                            </div>
                            {% endfor %}
                            <hr/>
                            <div class="text-right">
                              <button type="submit" class="btn btn-primary btn-sm"><strong>Submit Score</strong></button>
                            </div>
                        </form>
                    {% else %}
                        <!-- Score table -->
                        {% for sc in mat.score %}                      
                            <div class="row g-0 match-rasult align-items-center">
                                <div class="col-4">
                                    <label for="team1_score" class="mb-0">{{ sc.name }}</label>
                                </div>
                                {% for set in sc.score %}
                                    <div class="col-2">
                                        {{ set }}
                                    </div>
                                {% endfor %}
                                <div class="col-2 text-right">
                                  {% if mat.is_drow %}
                                    <span class="badge badge-warning">Draw</span>
                                  {% else %}
                                    {% if sc.is_win %}
                                      <span class="badge badge-success">Win</span>
                                    {% else %}
                                      <span class="badge badge-danger">Lost</span>
                                    {% endif %}
                                  {% endif %}
                                  
                                </div>
                            </div>
                        {% endfor %}
                    {% endif %}
                </div>
              </div>
          </div>
        {% endfor %}

        </div>
        <!-- Point Table -->
        <div class="tab-pane fade" id="point-table" role="tabpanel" aria-labelledby="point-table-tab">
          {% for court in point_table %} 
          <div class="py-3 px-3 bg-white rounded-1">
          <h3 class="h6">Point Table for Court {{court.court}}</h3>
            <table class="table table-striped">
              <thead>
                <tr>
                  <th scope="col">Team</th>
                  <th scope="col">Played</th>
                  <th scope="col">Won</th>
                  <th scope="col">Lost</th>
                  <th scope="col">Drow</th>
                  <th scope="col">For Score</th>
                  <th scope="col">Aginst Score</th>
                  <th scope="col">Points</th>
                </tr>
              </thead>
              <tbody>
                {% for data in court.all_tems %}
                <tr>
                  <td>{{data.name}}</td>
                  <td>{{data.completed_match}}</td>
                  <td>{{data.win_match}}</td>
                  <td>{{data.loss_match}}</td>
                  <td>{{data.drow_match}}</td>
                  <td>{{data.for_score}}</td>
                  <td>{{data.aginst_score}}</td>
                  <td>{{data.point}}</td>
                </tr>
                {% endfor %}
                <!-- Add more rows as needed -->
              </tbody>
            </table>
          </div>
          {% endfor %}
        </div>
        <!-- Knockout 
        <div class="tab-pane fade" id="knockout" role="tabpanel" aria-labelledby="knockout-tab">
          <h3>Knockout Stage</h3>
          <p>Semifinal: Team 1 vs Team 2</p>
          <p>Semifinal: Team 3 vs Team 4</p>
          <p>Final: Winner of Semifinal 1 vs Winner of Semifinal 2</p>
          <!-- Add more knockout stage details as needed 
        </div>-->
      </div>
    </div>
</div>
  <!-- Start Tournament Modal -->
  {% comment %} <div class="modal fade" id="startTournamentModal" tabindex="-1" aria-labelledby="startTournamentModalLabel" aria-hidden="true">
    <div class="modal-dialog">
      <div class="modal-content">
        <div class="modal-header">
          <h5 class="modal-title" id="startTournamentModalLabel">Start Tournament</h5>
          <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
        </div>
        <div class="modal-body">
          <!-- Add content for starting tournament modal -->
          <p>Are you sure you want to start the tournament?</p>
        </div>
        <div class="modal-footer">
          <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
          <button type="button" class="btn btn-primary">Start</button>
        </div>
      </div>
    </div>
  </div>
   {% endcomment %}
  <!-- Match 1 Modal -->
  <div class="modal fade" id="match1Modal" tabindex="-1" aria-labelledby="match1ModalLabel" aria-hidden="true">
    <div class="modal-dialog">
      <div class="modal-content">
        <div class="modal-header">
          <h5 class="modal-title" id="match1ModalLabel">Match 1: Team A vs Team B</h5>
          <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
        </div>
        <div class="modal-body">
          <!-- Add content for match 1 modal -->
          <p>Match details go here...</p>
        </div>
        <div class="modal-footer">
          <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
          <!-- Add additional buttons as needed -->
        </div>
      </div>
    </div>
  </div>
  
  <div class="modal fade" id="exampleModal" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel" aria-hidden="true">
    <div class="modal-dialog" role="document">
      <div class="modal-content">
        <div class="modal-header">
          <h5 class="modal-title" id="exampleModalLabel">Tournament Delete</h5>
          <button type="button" class="close" data-dismiss="modal" aria-label="Close">
            <span aria-hidden="true">&times;</span>
          </button>
        </div>
        <div class="modal-body">
          <p>Are you sure you want to delete this tournament {{tournament_details.name}}?</p>
        </div>
        <div class="modal-footer">
          <button type="button" class="btn btn-secondary" data-dismiss="modal">No</button>
          <form action="/admin/delete_tournament/{{ tournament_details.id }}/" method="post">
            {% csrf_token %}
            <button type="submit" class="btn btn-danger">Yes</button>
        </form>
        </div>
      </div>
    </div>
  </div>


    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/js/bootstrap.bundle.min.js"></script>
{% endblock %}
